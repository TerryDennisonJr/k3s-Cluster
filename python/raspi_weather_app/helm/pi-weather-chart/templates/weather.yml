# apiVersion: apps/v1
# kind: Deployment
# metadata:
#   creationTimestamp: null
#   labels:
#     app: sense-weather
#   name: sense-weather
#   # namespace: staging  
# spec:
#   replicas: 1
#   selector:
#     matchLabels:
#       app: sense-weather
#   strategy: {}
#   template:
#     metadata:
#       creationTimestamp: null
#       labels:
#         app: sense-weather
#     spec:
#       containers:
#       - image: infinitiq502004/raspiweather:26.0
#         name: raspiweather
#         env:
#         - name: MYSQL_HOST
#           # value: "mysql-svc.mysql.svc.cluster.local"
#           value: "mysql-svc"
#           # - name: DB_NAME
#           #   value: "weather-database"          
#           # - name: DB_USER
#           #   value: "weather-user" 
#           # - name: DB_PASSWORD
#           #   valueFrom:
#           #     secretKeyRef:
#           #       name: mysql-secret
#           #       key: password  
#           # - name: MYSQL_ROOT_PASSWORD
#           #   valueFrom:
#           #     secretKeyRef:
#           #       name: mysql-secret
#           #       key: password           
#         resources: {}
#         securityContext:
#           privileged: true
#       nodeSelector:
#         deployment_node: weather_app
# status: {}
# ---
apiVersion: batch/v1
kind: CronJob
metadata:
  creationTimestamp: null
  name: raspi-weather
spec:
  jobTemplate:
    metadata:
      creationTimestamp: null
      name: raspi-weather
    spec:
      template:
        metadata:
          creationTimestamp: null
        spec:
          containers:
          # - image: infinitiq502004/pi-weather:2.2
          - image: {{ .Values.imageTag}}
            imagePullPolicy: IfNotPresent
            env:
            - name: MYSQL_HOST
              value: "mysql-svc"
            # - name: DB_NAME
            #   value: "weather-database"          
            # - name: DB_USER
            #   value: "root" 
            # - name: DB_PASSWORD
            #   valueFrom:
            #     secretKeyRef:
            #       name: mysql-secret
            #       key: password  
            - name: MYSQL_ROOT_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: mysql-secret
                  key: password                                           
            name: raspiweather
            resources: {}
            securityContext:
              privileged: true            
          nodeSelector:
            deployment_node: weather_app
          restartPolicy: OnFailure
  schedule: 0/10 * * * ?
  successfulJobsHistoryLimit: 1
status: {}

